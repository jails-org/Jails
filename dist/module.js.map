{"mappings":"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","sources":["src/template-system.ts","src/utils/index.ts","src/utils/events.ts","src/utils/pubsub.ts","src/component.ts","src/element.ts","src/index.ts"],"sourcesContent":["import { compile, defaultConfig, filters } from 'squirrelly'\nimport { SqrlConfig } from 'squirrelly/dist/types/config'\nimport { decodeHtmlEntities } from './utils'\n\nconst defaultOptions: SqrlConfig = {\n\t...defaultConfig,\n\ttags: ['{', '}'],\n\tuseWith: true\n}\n\nexport default function templateSystem( element: HTMLElement ) {\n\n\tconst tree = document.createElement('template')\n\n\ttree.innerHTML = element.outerHTML.replace(/<\\/?template[^>]*>/g, '')\n\n\tdirectives(tree.content)\n\n\tconst html = decodeHtmlEntities(\n\t\ttree.innerHTML\n\t\t\t.replace(/html-(selected|checked|readonly|disabled|autoplay)=\\\"(.*)\\\"/g, `{@if ($2) }$1{/if}`)\n\t\t\t.replace(/html-/g, '')\n\t)\n\n\tconst template = compile(html, defaultOptions)\n\n\treturn ( data: object ) => {\n\t\treturn template(data, defaultOptions)\n\t}\n}\n\n/**@Directives */\n\nconst directives = (vdom: DocumentFragment) => {\n\n\tconst nodes = Array\n\t\t.from(vdom.querySelectorAll('[html-for],[html-if],[html-foreach]'))\n\t\t.reverse() as Array<HTMLElement>\n\n\tif (nodes.length) {\n\n\t\tnodes.forEach((node: HTMLElement ) => {\n\t\t\tif (node.getAttribute('html-foreach')) {\n\t\t\t\tconst instruction = node.getAttribute('html-foreach') || ''\n\t\t\t\tconst split = instruction.match(/(.*)\\sin\\s(.*)/) || ''\n\t\t\t\tconst varname = split[1]\n\t\t\t\tconst object = split[2]\n\t\t\t\tnode.removeAttribute('html-foreach')\n\t\t\t\tnode.setAttribute('scope', `{${varname} | JSON($key, '${varname}')}`)\n\t\t\t\tconst open = document.createTextNode(`{@foreach(${object}) => $key, ${varname}}`)\n\t\t\t\tconst close = document.createTextNode('{/foreach}')\n\t\t\t\twrap(open, node, close)\n\t\t\t} else if (node.getAttribute('html-for')) {\n\t\t\t\tconst instruction = node.getAttribute('html-for') || ''\n\t\t\t\tconst split = instruction.match(/(.*)\\sin\\s(.*)/) || ''\n\t\t\t\tconst varname = split[1]\n\t\t\t\tconst object = split[2]\n\t\t\t\tnode.removeAttribute('html-for')\n\t\t\t\tnode.setAttribute('scope', `{${varname} | JSON($index, '${varname}')}`)\n\t\t\t\tconst open = document.createTextNode(`{@each(${object}) => ${varname}, $index}`)\n\t\t\t\tconst close = document.createTextNode('{/each}')\n\t\t\t\twrap(open, node, close)\n\t\t\t} else if (node.getAttribute('html-if')) {\n\t\t\t\tconst instruction = node.getAttribute('html-if')\n\t\t\t\tnode.removeAttribute('html-if')\n\t\t\t\tconst open = document.createTextNode(`{@if (${instruction}) }`)\n\t\t\t\tconst close = document.createTextNode('{/if}')\n\t\t\t\twrap(open, node, close)\n\t\t\t}\n\t\t})\n\t}\n\n\treturn vdom\n}\n\nfilters.define('JSON', (scope, index, varname) => {\n\n\tconst key = index.constructor == String ? '$key' : '$index'\n\tconst newobject = { $index: index } as any\n\n\tnewobject[varname] = scope\n\tnewobject[key] = index\n\n\treturn JSON.stringify(newobject)\n})\n\nconst wrap = (open: Text, node :HTMLElement, close: Text) => {\n\tnode.parentNode?.insertBefore(open, node)\n\tnode.parentNode?.insertBefore(close, node.nextSibling)\n}\n","import templateSystem from '../template-system'\n\nconst textarea = document.createElement('textarea')\n\nexport const rAF = (fn) => {\n\tif (requestAnimationFrame)\n\t\treturn requestAnimationFrame(fn)\n\telse\n\t\treturn setTimeout(fn, 1000 / 60)\n}\n\nexport const uuid = () => {\n\treturn 'xxxxxxxx'.replace(/[xy]/g, (c) => {\n\t\tconst r = Math.random() * 8 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8)\n\t\treturn v.toString(8)\n\t})\n}\n\nexport const stripTemplateTag = ( element:HTMLElement | DocumentFragment | HTMLTemplateElement ) => {\n\tconst templates = Array.from(element.querySelectorAll('template'))\n\t// https://gist.github.com/harmenjanssen/07e425248779c65bc5d11b02fb913274\n\ttemplates.forEach((template: HTMLTemplateElement) => {\n\t\ttemplate.parentNode?.replaceChild(template.content, template)\n\t\tstripTemplateTag(template.content)\n\t})\n}\n\nexport const dup = (o) => {\n\treturn JSON.parse(JSON.stringify(o))\n}\n\nexport const createTemplateId = (element: HTMLElement, templates: any ) => {\n\n\tconst tplid = element.getAttribute('tplid')\n\n\tif (!tplid) {\n\t\tconst id = uuid()\n\t\telement.setAttribute('tplid', id)\n\t\ttemplates[id] = templateSystem(element)\n\t}\n}\n\nexport const buildtemplates = ( target: any, components: any, templates: any ) => {\n\n\treturn Array\n\t\t.from(target.querySelectorAll('*'))\n\t\t.filter((node: any) => node.tagName.toLowerCase() in components)\n\t\t.reverse()\n\t\t.map((node: any) => {\n\t\t\tArray.from(node.querySelectorAll('template'))\n\t\t\t\t.map(template => buildtemplates(template.content, components, templates))\n\t\t\tcreateTemplateId(node, templates)\n\t\t\treturn node\n\t\t})\n}\n\nexport const decodeHtmlEntities = ( str:string ) => {\n\ttextarea.innerHTML = str\n\treturn textarea.value\n}\n","const customEvent = (() => {\n\treturn ('CustomEvent' in window && typeof window.CustomEvent === 'function')\n\t\t? (name, data) => new CustomEvent(name, data)\n\t\t: (name, data) => {\n\t\t\tconst newEvent = document.createEvent('CustomEvent')\n\t\t\tnewEvent.initCustomEvent(name, true, true, data)\n\t\t\treturn newEvent\n\t\t}\n})()\n\nconst handler = (node, ev) => {\n\treturn function (e) {\n\t\tconst scope = this\n\t\tconst detail = e.detail || {}\n\t\tnode.__events[ev].forEach(o => {\n\t\t\to.handler.apply(scope, [e].concat(detail.args))\n\t\t})\n\t}\n}\n\nconst removeListener = (node, ev) => {\n\tif (node.__events[ev] && node.__events[ev].listener) {\n\t\tnode.removeEventListener(\n\t\t\tev,\n\t\t\tnode.__events[ev].listener,\n\t\t\t(ev == 'focus' || ev == 'blur' || ev == 'mouseenter' || ev == 'mouseleave'))\n\t\tdelete node.__events[ev]\n\t}\n}\n\nconst delegate = (node, selector, callback) => {\n\treturn function (e) {\n\n\t\tconst element = this\n\t\tconst detail = e.detail || {}\n\n\t\tlet parent = e.target\n\n\t\twhile (parent) {\n\t\t\tif (parent.matches(selector)) {\n\t\t\t\te.delegateTarget = parent\n\t\t\t\tcallback.apply(element, [e].concat(detail.args))\n\t\t\t}\n\t\t\tif (parent === node) break\n\t\t\tparent = parent.parentNode\n\t\t}\n\t}\n}\n\nexport const on = (node, ev, selectorOrCallback, callback) => {\n\n\tnode.__events = node.__events || {}\n\tnode.__events[ev] = (node.__events[ev] || [])\n\n\tif (!node.__events[ev].length) {\n\t\tconst fn = handler(node, ev)\n\t\tnode.addEventListener(\n\t\t\tev,\n\t\t\tfn,\n\t\t\t(ev == 'focus' || ev == 'blur' || ev == 'mouseenter' || ev == 'mouseleave'))\n\t\tnode.__events[ev].listener = fn\n\t}\n\n\tif (selectorOrCallback.call) {\n\t\tnode.__events[ev].push({ handler: selectorOrCallback, callback: selectorOrCallback })\n\t} else {\n\t\tnode.__events[ev].push({ handler: delegate(node, selectorOrCallback, callback), callback })\n\t}\n}\n\nexport const off = (node, ev, fn) => {\n\n\tif (fn && node.__events[ev] && node.__events[ev].length) {\n\t\tvar old = node.__events[ev]\n\t\tnode.__events[ev] = node.__events[ev].filter(function (o) { return o.callback != fn; })\n\t\tnode.__events[ev].listener = old.listener\n\t\tif (!node.__events[ev].length)\n\t\t\tremoveListener(node, ev)\n\t} else {\n\t\tremoveListener(node, ev)\n\t}\n}\n\nexport const trigger = (node, name, args) => {\n\tnode.dispatchEvent(customEvent(name, { bubbles: true, detail: args }))\n}\n","const topics: any = {}\nconst _async: any = {}\n\nexport const publish = (name: string, params: any) => {\n\t_async[name] = Object.assign({}, _async[name], params)\n\tif (topics[name])\n\t\ttopics[name].forEach(topic => topic(params))\n}\n\nexport const subscribe = (name: string, method: Function) => {\n\ttopics[name] = topics[name] || []\n\ttopics[name].push(method)\n\tif (name in _async) {\n\t\tmethod(_async[name])\n\t}\n}\n\nexport const unsubscribe = ( topic: any ) => {\n\ttopics[topic.name] = (topics[topic.name] || [])\n\t\t.filter((t: any) => t != topic.method)\n\tif (!topics[topic.name].length) {\n\t\tdelete topics[topic.name]\n\t\tdelete _async[topic.name]\n\t}\n}\n","import morphdom from 'morphdom'\n\nimport { rAF, dup, buildtemplates } from './utils'\nimport { on, off, trigger } from './utils/events'\nimport { publish, subscribe, unsubscribe } from './utils/pubsub'\n\ntype MainArgs = () => Array<Function>\n\nexport default function Component( elm:HTMLElement, { module, dependencies, templates, components }) {\n\n\tconst options = getOptions( module )\n\tbuildtemplates( elm, components, templates )\n\n\tconst tplid:string|null = elm.getAttribute('tplid')\n\tconst template = tplid ? templates[tplid] : null\n\tconst state = { data: module.model ? dup(module.model) : {} }\n\n\tconst base = {\n\t\ttemplate,\n\t\telm,\n\t\tdependencies,\n\t\tpublish,\n\t\tsubscribe,\n\t\tunsubscribe,\n\n\t\tmain(fn: MainArgs) {\n\t\t\toptions.main = fn\n\t\t},\n\n\t\tunmount(fn) {\n\t\t\toptions.unmount = fn\n\t\t},\n\n\t\tonupdate(fn) {\n\t\t\toptions.onupdate = fn\n\t\t},\n\n\t\ton(eventName: string, selectorOrCallback: object | Function, callback: Function) {\n\t\t\ton(elm, eventName, selectorOrCallback, callback)\n\t\t},\n\n\t\toff(eventName: string, callback: Function) {\n\t\t\toff(elm, eventName, callback)\n\t\t},\n\n\t\ttrigger(eventName: string, target: string, args: any) {\n\t\t\tif (target.constructor === String)\n\t\t\t\ttrigger(elm.querySelector(target), eventName, { args: args })\n\t\t\telse trigger(elm, eventName, { args: target })\n\t\t},\n\n\t\temit: (...args: any) => {\n\t\t\ttrigger(elm, args.shift(), { args: args })\n\t\t},\n\n\t\tstate: {\n\t\t\tset( data: any ) {\n\t\t\t\tif (data.constructor === Function) {\n\t\t\t\t\tconst newstate = dup(state.data)\n\t\t\t\t\tdata(newstate)\n\t\t\t\t\tbase.render(newstate)\n\t\t\t\t} else {\n\t\t\t\t\tbase.render(data)\n\t\t\t\t}\n\t\t\t\treturn new Promise((resolve) => rAF(_ => rAF(resolve)))\n\t\t\t},\n\t\t\tget(): object {\n\t\t\t\treturn dup(state.data)\n\t\t\t}\n\t\t},\n\n\t\trender(data: object = state.data) {\n\n\t\t\tif (!document.body.contains(elm))\n\t\t\t\treturn\n\n\t\t\tstate.data = Object.assign(state.data, data)\n\n\t\t\tconst newdata = dup(state.data)\n\t\t\tconst newhtml = base.template(options.view(newdata))\n\n\t\t\tmorphdom(elm, newhtml, morphdomOptions(elm, options))\n\n\t\t\trAF(_ => {\n\t\t\t\tArray\n\t\t\t\t\t.from(elm.querySelectorAll('[tplid]'))\n\t\t\t\t\t.forEach((child: any) => {\n\t\t\t\t\t\tchild.options.onupdate(newdata)\n\t\t\t\t\t\tchild.base.render(newdata)\n\t\t\t\t\t})\n\t\t\t})\n\t\t}\n\t}\n\n\treturn { base, options }\n}\n\nconst getOptions = (module: any) : any => ({\n\tmain: (a:any) => a,\n\tunmount: (a:any) => a,\n\tonupdate: (a:any) => a,\n\tview: module.view ? module.view : (a:any) => a\n})\n\nconst morphdomOptions = (_parent: HTMLElement, options: any) => ({\n\n\tonNodeAdded: onUpdates(_parent, options),\n\tonElUpdated: onUpdates(_parent, options),\n\tonBeforeElChildrenUpdated: checkStatic,\n\tonBeforeElUpdated: checkStatic,\n\n\tgetNodeKey(node: HTMLElement) {\n\t\tif (node.nodeType === 1 && node.getAttribute('tplid'))\n\t\t\treturn node.dataset.key || node.getAttribute('tplid')\n\t\treturn false\n\t}\n})\n\nconst checkStatic = (node: HTMLElement) => {\n\tif ('static' in node.dataset) {\n\t\treturn false\n\t}\n}\n\nconst onUpdates = (_parent: HTMLElement, options: any) => (node: HTMLElement) => {\n\n\tif (node.nodeType === 1) {\n\n\t\tif (node.getAttribute && node.getAttribute('scope')) {\n\n\t\t\tconst scope = JSON.parse((node.getAttribute('scope') ||'').replace(/\\'/g, '\\\"'))\n\n\t\t\tArray.from(node.querySelectorAll('[tplid]'))\n\t\t\t\t.map((el: any) => {\n\t\t\t\t\tconst data = Object.assign({}, _parent.base.state.get(), scope)\n\t\t\t\t\toptions.onupdate(data)\n\t\t\t\t\tel.base.render(data)\n\t\t\t\t})\n\n\t\t\tnode.removeAttribute('scope')\n\t\t}\n\t}\n\n\treturn node\n}\n","import Component from './component'\n\nexport default function Element(module, dependencies, templates, components) {\n\n\treturn class extends HTMLElement {\n\n\t\tbase: any\n\t\toptions: any\n\t\t__events: any\n\n\t\tconstructor() {\n\n\t\t\tsuper()\n\n\t\t\tconst { base, options } = Component(this, { module, dependencies, templates, components })\n\n\t\t\tthis.base = base\n\t\t\tthis.options = options\n\n\t\t\tmodule.default(base)\n\t\t}\n\n\t\tconnectedCallback() {\n\t\t\tthis.base.render()\n\t\t\tthis.options.main().forEach(f => f(this.base))\n\t\t}\n\n\t\tdisconnectedCallback() {\n\t\t\tthis.options.unmount(this.base)\n\t\t\tdelete this.options\n\t\t\tdelete this.base\n\t\t\tdelete this.__events\n\t\t}\n\n\t\tattributeChangedCallback() {\n\t\t\t//TODO\n\t\t}\n\t}\n}\n","import { buildtemplates } from './utils'\nimport Element from './element'\n\nexport const templates = {} as any\nexport const components = {} as any\n\nexport default {\n\n\tregister( name: string, module: any, dependencies: object = {} ) {\n\t\tcomponents[name] = { name, module, dependencies }\n\t},\n\n\tstart() {\n\t\tconst body = document.body\n\t\tbuildtemplates( body, components, templates )\n\t\tregisterComponents()\n\t}\n}\n\nconst registerComponents = () => {\n\tObject\n\t\t.values( components )\n\t\t.forEach( (component) => {\n\t\t\tconst { name, module, dependencies } = component as any\n\t\t\tconst Base = Element(module, dependencies, templates, components)\n\t\t\tcustomElements.define(name, Base)\n\t\t})\n}\n"],"names":["$43c832f2e2cffc12$var$defaultOptions","$iKK04$defaultConfig","tags","useWith","$43c832f2e2cffc12$export$2e2bcd8739ae039","element","tree","document","createElement","innerHTML","outerHTML","replace","$43c832f2e2cffc12$var$directives","content","html","$f83ec35b9cb8d3bf$export$5cfeaa4af6841c8f","template","$iKK04$compile","data","vdom","nodes","Array","from","querySelectorAll","reverse","length","forEach","node","getAttribute","split","match","varname","object","removeAttribute","setAttribute","open","createTextNode","close","$43c832f2e2cffc12$var$wrap","split1","varname1","object1","open1","close1","instruction2","open2","close2","$iKK04$filters","define","scope","index","key","constructor","String","newobject","$index","JSON","stringify","ref","ref1","parentNode","insertBefore","nextSibling","$f83ec35b9cb8d3bf$var$textarea","$f83ec35b9cb8d3bf$export$eba6076d3d7d0c06","fn","requestAnimationFrame","setTimeout","$f83ec35b9cb8d3bf$export$f4427c3005d2d1a9","o","parse","$f83ec35b9cb8d3bf$export$a144f425a562e60f","templates","id","c","r","Math","random","toString","$f83ec35b9cb8d3bf$export$4675c7fda24aa7cb","target","components","filter","tagName","toLowerCase","map","str","value","$e1106e785ed18d69$var$customEvent","window","CustomEvent","name","newEvent","createEvent","initCustomEvent","$e1106e785ed18d69$var$handler","ev","e","this","detail","__events","handler","apply","concat","args","$e1106e785ed18d69$var$removeListener","listener","removeEventListener","$e1106e785ed18d69$var$delegate","selector","callback","parent","matches","delegateTarget","$e1106e785ed18d69$export$af631764ddc44097","selectorOrCallback","addEventListener","call","push","$e1106e785ed18d69$export$8c8705df4a2dcec9","old","$e1106e785ed18d69$export$e614dc9140f7ae71","dispatchEvent","bubbles","$1242bda708bb315b$var$topics","$1242bda708bb315b$var$_async","$1242bda708bb315b$export$89b472e03be495df","params","Object","assign","topic","$1242bda708bb315b$export$ec068583843480e7","method","$1242bda708bb315b$export$f500693cef883ffd","t","$73c3652a601ab670$export$2e2bcd8739ae039","elm","module","dependencies","options","$73c3652a601ab670$var$getOptions","tplid","state","model","base","main","unmount","onupdate","on","eventName","off","trigger","querySelector","emit","shift","set","Function","newstate","render","Promise","resolve","_","get","body","contains","newdata","newhtml","view","$iKK04$morphdom","$73c3652a601ab670$var$morphdomOptions","child","a","_parent","onNodeAdded","$73c3652a601ab670$var$onUpdates","onElUpdated","onBeforeElChildrenUpdated","$73c3652a601ab670$var$checkStatic","onBeforeElUpdated","getNodeKey","nodeType","dataset","el","$9e47711e6b2057c7$export$2e2bcd8739ae039","HTMLElement","connectedCallback","f","disconnectedCallback","attributeChangedCallback","super","default","$ca8b1331e256cc84$export$a8fc3402335b0b04","$ca8b1331e256cc84$export$9b5ac10f59f76296","$ca8b1331e256cc84$export$2e2bcd8739ae039","register","start","$ca8b1331e256cc84$var$registerComponents","values","component","Base","customElements"],"version":3,"file":"module.js.map"}