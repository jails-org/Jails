(function(y,_){typeof exports=="object"&&typeof module!="undefined"?module.exports=_():typeof define=="function"&&define.amd?define(_):(y=typeof globalThis!="undefined"?globalThis:y||self,y.jails=_())})(this,function(){"use strict";var et=Object.defineProperty;var tt=(y,_,E)=>_ in y?et(y,_,{enumerable:!0,configurable:!0,writable:!0,value:E}):y[_]=E;var B=(y,_,E)=>(tt(y,typeof _!="symbol"?_+"":_,E),E);const y=new DOMParser;function _(e,t,n){const r=new RegExp(`\\${t.tags[0]}(.+?)\\${t.tags[1]}`,"g"),i=y.parseFromString(e.replace(/<\/?template[^>]*>/g,""),"text/html");return i.querySelectorAll("[html-for], [html-if], [html-inner], [html-class]").forEach(a=>{const s=a.getAttribute("html-foreach"),d=a.getAttribute("html-for"),A=a.getAttribute("html-if"),g=a.getAttribute("html-inner"),w=a.getAttribute("html-class"),b=d||s;if(b){const x=d?"html-for":"html-foreach",S=b.match(/(.*)\sin\s(.*)/)||"",o=S[1],p=S[2];a.removeAttribute(x);const T=Array.from(a.querySelectorAll(`[tplid]:not([${x}] [tplid])`)).map(O=>{const H=O.getAttribute("tplid");return n[H]=[],H}),N=document.createTextNode(`%%_(function(){ var $index = 0; for(var $key in safe(function(){ return ${p} }) ){ var ${o} = ${p}[$key]; ${JSON.stringify(T).replace(/\"/g,"'")}.map(function(id){ if($scopes[id]) { $scopes[id][$index] = { ${o}: ${p}[$key], $index: $index, $key: $key } } }); _%%`),$=document.createTextNode("%%_ $index++}})() _%%");E(N,a,$)}if(A){a.removeAttribute("html-if");const x=document.createTextNode(`%%_ if ( safe(function(){ return ${A} }) ){ _%%`),S=document.createTextNode("%%_ } _%%");E(x,a,S)}g&&(a.removeAttribute("html-inner"),a.innerHTML=`%%_=${g}_%%`),w&&(a.removeAttribute("html-class"),a.className=(a.className+` %%_=${w}_%%`).trim())}),i.body.innerHTML.replace(r,"%%_=$1_%%").replace(/html-(allowfullscreen|async|autofocus|autoplay|checked|controls|default|defer|disabled|formnovalidate|inert|ismap|itemscope|loop|multiple|muted|nomodule|novalidate|open|playsinline|readonly|required|reversed|selected)=\"(.*?)\"/g,"%%_if(safe(function(){ return $2 })){_%%$1%%_}_%%").replace(/html-(.*?)=\"(.*?)\"/g,(a,s,d)=>s==="key"||s==="model"||s=="scope"?a:d?(d=d.replace(/^{|}$/g,""),`${s}="%%_=safe(function(){ return ${d} })_%%"`):a)}const E=(e,t,n)=>{var r,i;(r=t.parentNode)==null||r.insertBefore(e,t),(i=t.parentNode)==null||i.insertBefore(n,t.nextSibling)},V=e=>requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,1e3/60),Ae=()=>"xxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*8|0;return(e=="x"?t:t&3|8).toString(8)}),k=e=>JSON.parse(JSON.stringify(e)),ie=e=>{var t=e.attributes,n,r,i;if(t)for(n=t.length-1;n>=0;n-=1)i=t[n].name,typeof e[i]=="function"&&(e[i]=null);if(t=e.childNodes,t)for(r=t.length,n=0;n<r;n+=1)ie(e.childNodes[n])},Te=(e,t)=>{try{return e()}catch(n){return t||""}},ae=document.createElement("textarea"),se={tags:["${","}"]},ye=e=>{Object.assign(se,e)};function xe(e,t){const n=_(e.outerHTML,se,t);ae.innerHTML=n;const r=JSON.stringify(ae.value);return new Function("$element","safe","$scopes",`
		var $data = this;
		with( $data ){
			var output=${r.replace(/%%_=(.+?)_%%/g,'"+safe(function(){return $1;})+"').replace(/%%_(.+?)_%%/g,`";$1
output+="`)};return output;
		}
	`)}const Y=(e,t,n,r)=>Array.from(e.querySelectorAll("*")).filter(i=>i.tagName.toLowerCase()in t).reverse().map(i=>(Array.from(i.querySelectorAll("template")).map(a=>Y(a.content,t,n,r)),Se(i,n,r),i)),Se=(e,t,n)=>{if(!e.getAttribute("tplid")){const i=Ae();e.setAttribute("tplid",i),t[i]=xe(e,n)}};var ce=11;function Ne(e,t){var n=t.attributes,r,i,a,s,d;if(!(t.nodeType===ce||e.nodeType===ce)){for(var A=n.length-1;A>=0;A--)r=n[A],i=r.name,a=r.namespaceURI,s=r.value,a?(i=r.localName||i,d=e.getAttributeNS(a,i),d!==s&&(r.prefix==="xmlns"&&(i=r.name),e.setAttributeNS(a,i,s))):(d=e.getAttribute(i),d!==s&&e.setAttribute(i,s));for(var g=e.attributes,w=g.length-1;w>=0;w--)r=g[w],i=r.name,a=r.namespaceURI,a?(i=r.localName||i,t.hasAttributeNS(a,i)||e.removeAttributeNS(a,i)):t.hasAttribute(i)||e.removeAttribute(i)}}var j,we="http://www.w3.org/1999/xhtml",m=typeof document=="undefined"?void 0:document,$e=!!m&&"content"in m.createElement("template"),Oe=!!m&&m.createRange&&"createContextualFragment"in m.createRange();function Ee(e){var t=m.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}function Ce(e){j||(j=m.createRange(),j.selectNode(m.body));var t=j.createContextualFragment(e);return t.childNodes[0]}function Ue(e){var t=m.createElement("body");return t.innerHTML=e,t.childNodes[0]}function Me(e){return e=e.trim(),$e?Ee(e):Oe?Ce(e):Ue(e)}function I(e,t){var n=e.nodeName,r=t.nodeName,i,a;return n===r?!0:(i=n.charCodeAt(0),a=r.charCodeAt(0),i<=90&&a>=97?n===r.toUpperCase():a<=90&&i>=97?r===n.toUpperCase():!1)}function Le(e,t){return!t||t===we?m.createElement(e):m.createElementNS(t,e)}function Re(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}function Q(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var ue={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();r==="OPTGROUP"&&(n=n.parentNode,r=n&&n.nodeName.toUpperCase()),r==="SELECT"&&!n.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}Q(e,t,"selected")},INPUT:function(e,t){Q(e,t,"checked"),Q(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var i=r.nodeValue;if(i==n||!n&&i==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n=-1,r=0,i=e.firstChild,a,s;i;)if(s=i.nodeName&&i.nodeName.toUpperCase(),s==="OPTGROUP")a=i,i=a.firstChild;else{if(s==="OPTION"){if(i.hasAttribute("selected")){n=r;break}r++}i=i.nextSibling,!i&&a&&(i=a.nextSibling,a=null)}e.selectedIndex=n}}},P=1,le=11,oe=3,fe=8;function C(){}function De(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Fe(e){return function(n,r,i){if(i||(i={}),typeof r=="string")if(n.nodeName==="#document"||n.nodeName==="HTML"||n.nodeName==="BODY"){var a=r;r=m.createElement("html"),r.innerHTML=a}else r=Me(r);else r.nodeType===le&&(r=r.firstElementChild);var s=i.getNodeKey||De,d=i.onBeforeNodeAdded||C,A=i.onNodeAdded||C,g=i.onBeforeElUpdated||C,w=i.onElUpdated||C,b=i.onBeforeNodeDiscarded||C,x=i.onNodeDiscarded||C,S=i.onBeforeElChildrenUpdated||C,o=i.skipFromChildren||C,p=i.addChild||function(u,c){return u.appendChild(c)},T=i.childrenOnly===!0,N=Object.create(null),$=[];function O(u){$.push(u)}function H(u,c){if(u.nodeType===P)for(var h=u.firstChild;h;){var l=void 0;c&&(l=s(h))?O(l):(x(h),h.firstChild&&H(h,c)),h=h.nextSibling}}function K(u,c,h){b(u)!==!1&&(c&&c.removeChild(u),x(u),H(u,h))}function be(u){if(u.nodeType===P||u.nodeType===le)for(var c=u.firstChild;c;){var h=s(c);h&&(N[h]=c),be(c),c=c.nextSibling}}be(n);function ee(u){A(u);for(var c=u.firstChild;c;){var h=c.nextSibling,l=s(c);if(l){var f=N[l];f&&I(c,f)?(c.parentNode.replaceChild(f,c),X(f,c)):ee(c)}else ee(c);c=h}}function Ye(u,c,h){for(;c;){var l=c.nextSibling;(h=s(c))?O(h):K(c,u,!0),c=l}}function X(u,c,h){var l=s(c);l&&delete N[l],!(!h&&(g(u,c)===!1||(e(u,c),w(u),S(u,c)===!1)))&&(u.nodeName!=="TEXTAREA"?Qe(u,c):ue.TEXTAREA(u,c))}function Qe(u,c){var h=o(u),l=c.firstChild,f=u.firstChild,D,U,F,J,M;e:for(;l;){for(J=l.nextSibling,D=s(l);!h&&f;){if(F=f.nextSibling,l.isSameNode&&l.isSameNode(f)){l=J,f=F;continue e}U=s(f);var W=f.nodeType,L=void 0;if(W===l.nodeType&&(W===P?(D?D!==U&&((M=N[D])?F===M?L=!1:(u.insertBefore(M,f),U?O(U):K(f,u,!0),f=M):L=!1):U&&(L=!1),L=L!==!1&&I(f,l),L&&X(f,l)):(W===oe||W==fe)&&(L=!0,f.nodeValue!==l.nodeValue&&(f.nodeValue=l.nodeValue))),L){l=J,f=F;continue e}U?O(U):K(f,u,!0),f=F}if(D&&(M=N[D])&&I(M,l))h||p(u,M),X(M,l);else{var re=d(l);re!==!1&&(re&&(l=re),l.actualize&&(l=l.actualize(u.ownerDocument||m)),p(u,l),ee(l))}l=J,f=F}Ye(u,f,U);var _e=ue[u.nodeName];_e&&_e(u,c)}var v=n,z=v.nodeType,me=r.nodeType;if(!T){if(z===P)me===P?I(n,r)||(x(n),v=Re(n,Le(r.nodeName,r.namespaceURI))):v=r;else if(z===oe||z===fe){if(me===z)return v.nodeValue!==r.nodeValue&&(v.nodeValue=r.nodeValue),v;v=r}}if(v===r)x(n);else{if(r.isSameNode&&r.isSameNode(v))return;if(X(v,r,T),$)for(var te=0,Ze=$.length;te<Ze;te++){var ne=N[$[te]];ne&&K(ne,ne.parentNode,!1)}}return!T&&v!==n&&n.parentNode&&(v.actualize&&(v=v.actualize(n.ownerDocument||m)),n.parentNode.replaceChild(v,n)),v}}var Pe=Fe(Ne);const He=(()=>"CustomEvent"in window&&typeof window.CustomEvent=="function"?(e,t)=>new CustomEvent(e,t):(e,t)=>{const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,t),n})(),Be=(e,t)=>function(n){const r=this,i=n.detail||{};e.__events[t].forEach(a=>{a.handler.apply(r,[n].concat(i.args))})},de=(e,t)=>{e.__events[t]&&e.__events[t].listener&&(e.removeEventListener(t,e.__events[t].listener,t=="focus"||t=="blur"||t=="mouseenter"||t=="mouseleave"),delete e.__events[t])},Ve=(e,t,n)=>function(r){const i=this,a=r.detail||{};let s=r.target;for(;s&&(s.matches(t)&&(r.delegateTarget=s,n.apply(i,[r].concat(a.args))),s!==e);)s=s.parentNode},ke=(e,t,n,r)=>{if(e.__events=e.__events||{},e.__events[t]=e.__events[t]||[],!e.__events[t].length){const i=Be(e,t);e.addEventListener(t,i,t=="focus"||t=="blur"||t=="mouseenter"||t=="mouseleave"),e.__events[t].listener=i}n.call?e.__events[t].push({handler:n,callback:n}):e.__events[t].push({handler:Ve(e,n,r),callback:r})},je=(e,t,n)=>{if(n&&e.__events[t]&&e.__events[t].length){var r=e.__events[t];e.__events[t]=e.__events[t].filter(function(i){return i.callback!=n}),e.__events[t].listener=r.listener,e.__events[t].length||de(e,t)}else de(e,t)},Z=(e,t,n)=>{e.dispatchEvent(He(t,{bubbles:!0,detail:n}))},R={},q={},Ie=(e,t)=>{q[e]=Object.assign({},q[e],t),R[e]&&R[e].forEach(n=>n(t))},qe=(e,t)=>(R[e]=R[e]||[],R[e].push(t),e in q&&t(q[e]),()=>{R[e]=R[e].filter(n=>n!=t)});function Ge(e,{module:t,dependencies:n,templates:r,components:i,$scopes:a}){const s=Ke(t);Y(e,i,r,a);const d=e.getAttribute("html-model"),A=d?new Function(`return ${d}`)():{},g=e.getAttribute("tplid"),w=g?r[g]:null,b={data:t.model?k(t.model):{}},x=a[g]&&a[g].length?a[g].shift():{};b.data=Object.assign(x,b.data,A);const S={template:w,elm:e,dependencies:n,publish:Ie,subscribe:qe,main(o){s.main=o},unmount(o){s.unmount=o},onupdate(o){s.onupdate=o},on(o,p,T){ke(e,o,p,T)},off(o,p){je(e,o,p)},trigger(o,p,T){p.constructor===String?Array.from(e.querySelectorAll(p)).forEach(N=>Z(N,o,{args:T})):Z(e,o,{args:p})},emit:(...o)=>{Z(e,o.shift(),{args:o})},state:{set(o){if(o.constructor===Function){const p=k(b.data);o(p),S.render(p)}else S.render(o);return new Promise(p=>V(T=>V(()=>p(b.data))))},get(){return k(b.data)},getRaw(){return b.data}},render(o=b.data){if(!document.body.contains(e))return;b.data=Object.assign(b.data,o);const p=k(b.data),T=S.template.call(s.view(p),e,Te,a);Pe(e,T,Xe()),V(N=>{Array.from(e.querySelectorAll("[tplid]")).forEach($=>{const O=Object.assign($.base.state.getRaw(),p);$.options.onupdate(O),$.base.render(O)})})}};return{base:S,options:s}}const Ke=e=>({main:t=>t,unmount:t=>t,onupdate:t=>t,view:e.view?e.view:t=>t}),Xe=e=>({onNodeAdded:he,onElUpdated:he,onBeforeElChildrenUpdated:pe,onBeforeElUpdated:pe}),pe=e=>{if("html-static"in e.attributes)return!1},he=e=>e.nodeType===1&&e.getAttribute("tplid")?!1:e;function ze(e,t,n,r,i){return class extends HTMLElement{constructor(){super();B(this,"base");B(this,"options");B(this,"returns");B(this,"__events");const{base:s,options:d}=Ge(this,{module:e,dependencies:t,templates:n,components:r,$scopes:i});this.base=s,this.options=d,this.returns=e.default(s)}connectedCallback(){var s;this.base.render(),this.returns&&this.returns.constructor===Promise?this.returns.then(d=>{var A;this.base&&((A=this.options.main())==null||A.forEach(g=>g(this.base)))}):(s=this.options.main())==null||s.forEach(d=>d(this.base))}disconnectedCallback(){this.options.unmount(this.base),V(()=>{document.body.contains(this)||(this.__events&&(this.__events=null),this.base&&(this.base.elm=null),this.base&&(this.base=null),ie(this))})}attributeChangedCallback(){}}}const ve={},G={},ge={},Je={templateConfig:ye,register(e,t,n){G[e]={name:e,module:t,dependencies:n}},start(){const e=document.body;Y(e,G,ve,ge),We()}},We=()=>{Object.values(G).forEach(e=>{const{name:t,module:n,dependencies:r}=e,i=ze(n,r,ve,G,ge);customElements.define(t,i)})};return Je});
//# sourceMappingURL=index.js.map
