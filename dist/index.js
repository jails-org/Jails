!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("jails",[],t):"object"==typeof exports?exports.jails=t():e.jails=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>M});const n=new DOMParser,r=(e,t,n)=>{var r,o;null===(r=t.parentNode)||void 0===r||r.insertBefore(e,t),null===(o=t.parentNode)||void 0===o||o.insertBefore(n,t.nextSibling)},o=e=>requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,1e3/60),a=e=>JSON.parse(JSON.stringify(e)),i=e=>{var t,n,r,o=e.attributes;if(o)for(t=o.length-1;t>=0;t-=1)"function"==typeof e[r=o[t].name]&&(e[r]=null);if(o=e.childNodes)for(n=o.length,t=0;t<n;t+=1)i(e.childNodes[t])},s=(e,t)=>{try{return e()}catch(e){return t||""}},l=document.createElement("textarea"),d={tags:["${","}"]};const u=(e,t,n,r)=>Array.from(e.querySelectorAll("*")).filter((e=>e.tagName.toLowerCase()in t)).reverse().map((e=>(Array.from(e.querySelectorAll("template")).map((e=>u(e.content,t,n,r))),c(e,n,r),e))),c=(e,t,o)=>{if(!e.getAttribute("tplid")){const a="xxxxxxxx".replace(/[xy]/g,(e=>{const t=8*Math.random()|0;return("x"==e?t:3&t|8).toString(8)}));e.setAttribute("tplid",a),t[a]=function(e,t){const o=function(e,t,o){const a=new RegExp(`\\${t.tags[0]}(.+?)\\${t.tags[1]}`,"g"),i=n.parseFromString(e.replace(/<\/?template[^>]*>/g,""),"text/html");return i.querySelectorAll("[html-for], [html-if], [html-inner], [html-class]").forEach((e=>{const t=e.getAttribute("html-foreach"),n=e.getAttribute("html-for"),a=e.getAttribute("html-if"),i=e.getAttribute("html-inner"),s=e.getAttribute("html-class"),l=n||t;if(l){const t=n?"html-for":"html-foreach",a=l.match(/(.*)\sin\s(.*)/)||"",i=a[1],s=a[2];e.removeAttribute(t);const d=Array.from(e.querySelectorAll(`[tplid]:not([${t}] [tplid])`)).map((e=>{const t=e.getAttribute("tplid");return o[t]=[],t})),u=document.createTextNode(`%%_(function(){ var $index = 0; for(var $key in safe(function(){ return ${s} }) ){ var ${i} = ${s}[$key]; ${JSON.stringify(d).replace(/\"/g,"'")}.map(function(id){ if($scopes[id]) { $scopes[id][$index] = { ${i}: ${s}[$key], $index: $index, $key: $key } } }); _%%`),c=document.createTextNode("%%_ $index++}})() _%%");r(u,e,c)}if(a){e.removeAttribute("html-if");const t=document.createTextNode(`%%_ if ( safe(function(){ return ${a} }) ){ _%%`),n=document.createTextNode("%%_ } _%%");r(t,e,n)}i&&(e.removeAttribute("html-inner"),e.innerHTML=`%%_=${i}_%%`),s&&(e.removeAttribute("html-class"),e.className=(e.className+` %%_=${s}_%%`).trim())})),i.body.innerHTML.replace(a,"%%_=$1_%%").replace(/html-(allowfullscreen|async|autofocus|autoplay|checked|controls|default|defer|disabled|formnovalidate|inert|ismap|itemscope|loop|multiple|muted|nomodule|novalidate|open|playsinline|readonly|required|reversed|selected)=\"(.*?)\"/g,"%%_if(safe(function(){ return $2 })){_%%$1%%_}_%%").replace(/html-(.*?)=\"(.*?)\"/g,((e,t,n)=>"key"===t||"model"===t||"scope"==t?e:n?`${t}="%%_=safe(function(){ return ${n=n.replace(/^{|}$/g,"")} })_%%"`:e))}(e.outerHTML,d,t);l.innerHTML=o;const a=JSON.stringify(l.value);return new Function("$element","safe","$scopes",`\n\t\tvar $data = this;\n\t\twith( $data ){\n\t\t\tvar output=${a.replace(/%%_=(.+?)_%%/g,'"+safe(function(){return $1;})+"').replace(/%%_(.+?)_%%/g,'";$1\noutput+="')};return output;\n\t\t}\n\t`)}(e,o)}};var f,m="undefined"==typeof document?void 0:document,p=!!m&&"content"in m.createElement("template"),h=!!m&&m.createRange&&"createContextualFragment"in m.createRange();function v(e,t){var n,r,o=e.nodeName,a=t.nodeName;return o===a||(n=o.charCodeAt(0),r=a.charCodeAt(0),n<=90&&r>=97?o===a.toUpperCase():r<=90&&n>=97&&a===o.toUpperCase())}function b(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var g={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}b(e,t,"selected")},INPUT:function(e,t){b(e,t,"checked"),b(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=o}}};function _(){}function y(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const A=function(e,t,n){if(n||(n={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var r=t;(t=m.createElement("html")).innerHTML=r}else o=(o=t).trim(),t=p?function(e){var t=m.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(o):h?function(e){return f||(f=m.createRange()).selectNode(m.body),f.createContextualFragment(e).childNodes[0]}(o):function(e){var t=m.createElement("body");return t.innerHTML=e,t.childNodes[0]}(o);else 11===t.nodeType&&(t=t.firstElementChild);var o,a=n.getNodeKey||y,i=n.onBeforeNodeAdded||_,s=n.onNodeAdded||_,l=n.onBeforeElUpdated||_,d=n.onElUpdated||_,u=n.onBeforeNodeDiscarded||_,c=n.onNodeDiscarded||_,b=n.onBeforeElChildrenUpdated||_,A=n.skipFromChildren||_,N=n.addChild||function(e,t){return e.appendChild(t)},x=!0===n.childrenOnly,E=Object.create(null),C=[];function T(e){C.push(e)}function $(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var r=void 0;t&&(r=a(n))?T(r):(c(n),n.firstChild&&$(n,t)),n=n.nextSibling}}function S(e,t,n){!1!==u(e)&&(t&&t.removeChild(e),c(e),$(e,n))}function O(e){s(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=a(t);if(r){var o=E[r];o&&v(t,o)?(t.parentNode.replaceChild(o,t),w(o,t)):O(t)}else O(t);t=n}}function w(e,t,n){var r=a(t);if(r&&delete E[r],!n){if(!1===l(e,t))return;if(function(e,t){var n,r,o,a,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=i.length-1;s>=0;s--)r=(n=i[s]).name,o=n.namespaceURI,a=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==a&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,a))):e.getAttribute(r)!==a&&e.setAttribute(r,a);for(var l=e.attributes,d=l.length-1;d>=0;d--)r=(n=l[d]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}}(e,t),d(e),!1===b(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,o,s,l,d=A(e),u=t.firstChild,c=e.firstChild;e:for(;u;){for(s=u.nextSibling,n=a(u);!d&&c;){if(o=c.nextSibling,u.isSameNode&&u.isSameNode(c)){u=s,c=o;continue e}r=a(c);var f=c.nodeType,p=void 0;if(f===u.nodeType&&(1===f?(n?n!==r&&((l=E[n])?o===l?p=!1:(e.insertBefore(l,c),r?T(r):S(c,e,!0),c=l):p=!1):r&&(p=!1),(p=!1!==p&&v(c,u))&&w(c,u)):3!==f&&8!=f||(p=!0,c.nodeValue!==u.nodeValue&&(c.nodeValue=u.nodeValue))),p){u=s,c=o;continue e}r?T(r):S(c,e,!0),c=o}if(n&&(l=E[n])&&v(l,u))d||N(e,l),w(l,u);else{var h=i(u);!1!==h&&(h&&(u=h),u.actualize&&(u=u.actualize(e.ownerDocument||m)),N(e,u),O(u))}u=s,c=o}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=a(t))?T(n):S(t,e,!0),t=r}}(e,c,r);var b=g[e.nodeName];b&&b(e,t)}(e,t):g.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var r=a(n);r&&(E[r]=n),e(n),n=n.nextSibling}}(e);var j,U,k=e,L=k.nodeType,P=t.nodeType;if(!x)if(1===L)1===P?v(e,t)||(c(e),k=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(e,(j=t.nodeName,(U=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==U?m.createElementNS(U,j):m.createElement(j)))):k=t;else if(3===L||8===L){if(P===L)return k.nodeValue!==t.nodeValue&&(k.nodeValue=t.nodeValue),k;k=t}if(k===t)c(e);else{if(t.isSameNode&&t.isSameNode(k))return;if(w(k,t,x),C)for(var R=0,M=C.length;R<M;R++){var B=E[C[R]];B&&S(B,B.parentNode,!1)}}return!x&&k!==e&&e.parentNode&&(k.actualize&&(k=k.actualize(e.ownerDocument||m)),e.parentNode.replaceChild(k,e)),k},N="CustomEvent"in window&&"function"==typeof window.CustomEvent?(e,t)=>new CustomEvent(e,t):(e,t)=>{const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,t),n},x=(e,t)=>function(n){const r=this,o=n.detail||{};e.__events[t].forEach((e=>{e.handler.apply(r,[n].concat(o.args))}))},E=(e,t)=>{e.__events[t]&&e.__events[t].listener&&(e.removeEventListener(t,e.__events[t].listener,"focus"==t||"blur"==t||"mouseenter"==t||"mouseleave"==t),delete e.__events[t])},C=(e,t,n)=>function(r){const o=this,a=r.detail||{};let i=r.target;for(;i&&(i.matches(t)&&(r.delegateTarget=i,n.apply(o,[r].concat(a.args))),i!==e);)i=i.parentNode},T=(e,t,n)=>{e.dispatchEvent(N(t,{bubbles:!0,detail:n}))},$={},S={},O=(e,t)=>{S[e]=Object.assign({},S[e],t),$[e]&&$[e].forEach((e=>e(t)))},w=(e,t)=>($[e]=$[e]||[],$[e].push(t),e in S&&t(S[e]),()=>{$[e]=$[e].filter((e=>e!=t))}),j=e=>{if("html-static"in e.attributes)return!1},U=e=>(1!==e.nodeType||!e.getAttribute("tplid"))&&e;function k(e,t,n,r,l){return class extends HTMLElement{constructor(){super();const{base:i,options:d}=function(e,{module:t,dependencies:n,templates:r,components:i,$scopes:l}){const d=(e=>({main:e=>e,unmount:e=>e,onupdate:e=>e,view:e.view?e.view:e=>e}))(t);u(e,i,r,l);const c=e.getAttribute("html-model"),f=c?new Function(`return ${c}`)():{},m=e.getAttribute("tplid"),p=m?r[m]:null,h={data:t.model?a(t.model):{}},v=l[m]&&l[m].length?l[m].shift():{};h.data=Object.assign(v,h.data,f);const b={template:p,elm:e,dependencies:n,publish:O,subscribe:w,main(e){d.main=e},unmount(e){d.unmount=e},onupdate(e){d.onupdate=e},on(t,n,r){((e,t,n,r)=>{if(e.__events=e.__events||{},e.__events[t]=e.__events[t]||[],!e.__events[t].length){const n=x(e,t);e.addEventListener(t,n,"focus"==t||"blur"==t||"mouseenter"==t||"mouseleave"==t),e.__events[t].listener=n}n.call?e.__events[t].push({handler:n,callback:n}):e.__events[t].push({handler:C(e,n,r),callback:r})})(e,t,n,r)},off(t,n){((e,t,n)=>{if(n&&e.__events[t]&&e.__events[t].length){var r=e.__events[t];e.__events[t]=e.__events[t].filter((function(e){return e.callback!=n})),e.__events[t].listener=r.listener,e.__events[t].length||E(e,t)}else E(e,t)})(e,t,n)},trigger(t,n,r){n.constructor===String?Array.from(e.querySelectorAll(n)).forEach((e=>T(e,t,{args:r}))):T(e,t,{args:n})},emit:(...t)=>{T(e,t.shift(),{args:t})},state:{set(e){if(e.constructor===Function){const t=a(h.data);e(t),b.render(t)}else b.render(e);return new Promise((e=>o((t=>o((()=>e(h.data)))))))},get:()=>a(h.data),getRaw:()=>h.data},render(t=h.data){if(!document.body.contains(e))return;h.data=Object.assign(h.data,t);const n=a(h.data),r=b.template.call(d.view(n),e,s,l);A(e,r,{onNodeAdded:U,onElUpdated:U,onBeforeElChildrenUpdated:j,onBeforeElUpdated:j}),o((t=>{Array.from(e.querySelectorAll("[tplid]")).forEach((e=>{const t=Object.assign(e.base.state.getRaw(),n);e.options.onupdate(t),e.base.render(t)}))}))}};return{base:b,options:d}}(this,{module:e,dependencies:t,templates:n,components:r,$scopes:l});this.base=i,this.options=d,this.returns=e.default(i)}connectedCallback(){var e;this.base.render(),this.returns&&this.returns.constructor===Promise?this.returns.then((e=>{var t;this.base&&(null===(t=this.options.main())||void 0===t||t.forEach((e=>e(this.base))))})):null===(e=this.options.main())||void 0===e||e.forEach((e=>e(this.base)))}disconnectedCallback(){this.options.unmount(this.base),o((()=>{document.body.contains(this)||(this.__events&&(this.__events=null),this.base&&(this.base.elm=null),this.base&&(this.base=null),i(this))}))}attributeChangedCallback(){}}}const L={},P={},R={},M={templateConfig:e=>{Object.assign(d,e)},register(e,t,n){P[e]={name:e,module:t,dependencies:n}},start(){const e=document.body;u(e,P,L,R),B()}},B=()=>{Object.values(P).forEach((e=>{const{name:t,module:n,dependencies:r}=e,o=k(n,r,L,P,R);customElements.define(t,o)}))};return t})()));
//# sourceMappingURL=index.js.map