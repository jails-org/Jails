var e,t=require("squirrelly"),n=require("morphdom");function r(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}e=module.exports,Object.defineProperty(e,"__esModule",{value:!0,configurable:!0}),r(module.exports,"templates",(function(){return w})),r(module.exports,"components",(function(){return L})),r(module.exports,"default",(function(){return M}));const o={...t.defaultConfig,tags:["{","}"],useWith:!0};function s(e){const n=document.createElement("template");n.innerHTML=e.outerHTML.replace(/<\/?template[^>]*>/g,""),a(n.content);const r=f(n.innerHTML.replace(/html-(selected|checked|readonly|disabled|autoplay)=\"(.*)\"/g,"{@if ($2) }$1{/if}").replace(/html-/g,"")),s=(0,t.compile)(r,o);return e=>s(e,o)}const a=e=>{const t=Array.from(e.querySelectorAll("[html-for],[html-if],[html-foreach]")).reverse();return t.length&&t.forEach((e=>{if(e.getAttribute("html-foreach")){const t=(e.getAttribute("html-foreach")||"").match(/(.*)\sin\s(.*)/)||"",n=t[1],r=t[2];e.removeAttribute("html-foreach"),e.setAttribute("scope",`{${n} | JSON($key, '${n}')}`);const o=document.createTextNode(`{@foreach(${r}) => $key, ${n}}`),s=document.createTextNode("{/foreach}");i(o,e,s)}else if(e.getAttribute("html-for")){const t=(e.getAttribute("html-for")||"").match(/(.*)\sin\s(.*)/)||"",n=t[1],r=t[2];e.removeAttribute("html-for"),e.setAttribute("scope",`{${n} | JSON($index, '${n}')}`);const o=document.createTextNode(`{@each(${r}) => ${n}, $index}`),s=document.createTextNode("{/each}");i(o,e,s)}else if(e.getAttribute("html-if")){const t=e.getAttribute("html-if");e.removeAttribute("html-if");const n=document.createTextNode(`{@if (${t}) }`),r=document.createTextNode("{/if}");i(n,e,r)}})),e};t.filters.define("JSON",((e,t,n)=>{const r=t.constructor==String?"$key":"$index",o={$index:t};return o[n]=e,o[r]=t,JSON.stringify(o)}));const i=(e,t,n)=>{var r,o;null===(r=t.parentNode)||void 0===r||r.insertBefore(e,t),null===(o=t.parentNode)||void 0===o||o.insertBefore(n,t.nextSibling)},c=document.createElement("textarea"),l=e=>requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,1e3/60),u=e=>JSON.parse(JSON.stringify(e)),d=(e,t)=>{if(!e.getAttribute("tplid")){const n="xxxxxxxx".replace(/[xy]/g,(e=>{const t=8*Math.random()|0;return("x"==e?t:3&t|8).toString(8)}));e.setAttribute("tplid",n),t[n]=s(e)}},m=(e,t,n)=>Array.from(e.querySelectorAll("*")).filter((e=>e.tagName.toLowerCase()in t)).reverse().map((e=>(Array.from(e.querySelectorAll("template")).map((e=>m(e.content,t,n))),d(e,n),e))),f=e=>(c.innerHTML=e,c.value),p="CustomEvent"in window&&"function"==typeof window.CustomEvent?(e,t)=>new CustomEvent(e,t):(e,t)=>{const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,t),n},h=(e,t)=>function(n){const r=this,o=n.detail||{};e.__events[t].forEach((e=>{e.handler.apply(r,[n].concat(o.args))}))},b=(e,t)=>{e.__events[t]&&e.__events[t].listener&&(e.removeEventListener(t,e.__events[t].listener,"focus"==t||"blur"==t||"mouseenter"==t||"mouseleave"==t),delete e.__events[t])},g=(e,t,n)=>function(r){const o=this,s=r.detail||{};let a=r.target;for(;a&&(a.matches(t)&&(r.delegateTarget=a,n.apply(o,[r].concat(s.args))),a!==e);)a=a.parentNode},v=(e,t,n,r)=>{if(e.__events=e.__events||{},e.__events[t]=e.__events[t]||[],!e.__events[t].length){const n=h(e,t);e.addEventListener(t,n,"focus"==t||"blur"==t||"mouseenter"==t||"mouseleave"==t),e.__events[t].listener=n}n.call?e.__events[t].push({handler:n,callback:n}):e.__events[t].push({handler:g(e,n,r),callback:r})},_=(e,t,n)=>{if(n&&e.__events[t]&&e.__events[t].length){var r=e.__events[t];e.__events[t]=e.__events[t].filter((function(e){return e.callback!=n})),e.__events[t].listener=r.listener,e.__events[t].length||b(e,t)}else b(e,t)},A=(e,t,n)=>{e.dispatchEvent(p(t,{bubbles:!0,detail:n}))},y={},x={},E=(e,t)=>{x[e]=Object.assign({},x[e],t),y[e]&&y[e].forEach((e=>e(t)))},N=(e,t)=>{y[e]=y[e]||[],y[e].push(t),e in x&&t(x[e])},$=e=>{y[e.name]=(y[e.name]||[]).filter((t=>t!=e.method)),y[e.name].length||(delete y[e.name],delete x[e.name])};function S(e,{module:t,dependencies:r,templates:o,components:s}){const a=T(t);m(e,s,o);const i=e.getAttribute("tplid"),c=i?o[i]:null,d={data:t.model?u(t.model):{}},f={template:c,elm:e,dependencies:r,publish:E,subscribe:N,unsubscribe:$,main(e){a.main=e},unmount(e){a.unmount=e},onupdate(e){a.onupdate=e},on(t,n,r){v(e,t,n,r)},off(t,n){_(e,t,n)},trigger(t,n,r){n.constructor===String?A(e.querySelector(n),t,{args:r}):A(e,t,{args:n})},emit:(...t)=>{A(e,t.shift(),{args:t})},state:{set(e){if(e.constructor===Function){const t=u(d.data);e(t),f.render(t)}else f.render(e);return new Promise((e=>l((t=>l(e)))))},get:()=>u(d.data)},render(t=d.data){if(!document.body.contains(e))return;d.data=Object.assign(d.data,t);const r=u(d.data),o=f.template(a.view(r));!function(e){return e&&e.__esModule?e.default:e}(n)(e,o,O(e,a)),l((t=>{Array.from(e.querySelectorAll("[tplid]")).forEach((e=>{e.options.onupdate(r),e.base.render(r)}))}))}};return{base:f,options:a}}const T=e=>({main:e=>e,unmount:e=>e,onupdate:e=>e,view:e.view?e.view:e=>e}),O=(e,t)=>({onNodeAdded:k(e,t),onElUpdated:k(e,t),onBeforeElChildrenUpdated:C,onBeforeElUpdated:C,getNodeKey:e=>!(1!==e.nodeType||!e.getAttribute("tplid"))&&(e.dataset.key||e.getAttribute("tplid"))}),C=e=>{if("static"in e.dataset)return!1},k=(e,t)=>n=>{if(1===n.nodeType&&n.getAttribute&&n.getAttribute("scope")){const r=JSON.parse((n.getAttribute("scope")||"").replace(/\'/g,'"'));Array.from(n.querySelectorAll("[tplid]")).map((n=>{const o=Object.assign({},e.base.state.get(),r);t.onupdate(o),n.base.render(o)})),n.removeAttribute("scope")}return n};function q(e,t,n,r){return class extends HTMLElement{connectedCallback(){this.base.render(),this.options.main().forEach((e=>e(this.base)))}disconnectedCallback(){this.options.unmount(this.base),delete this.options,delete this.base,delete this.__events}attributeChangedCallback(){}constructor(){super();const{base:o,options:s}=S(this,{module:e,dependencies:t,templates:n,components:r});this.base=o,this.options=s,e.default(o)}}}const w={},L={};var M={register(e,t,n={}){L[e]={name:e,module:t,dependencies:n}},start(){const e=document.body;m(e,L,w),J()}};const J=()=>{Object.values(L).forEach((e=>{const{name:t,module:n,dependencies:r}=e,o=q(n,r,w,L);customElements.define(t,o)}))};
//# sourceMappingURL=index.js.map
